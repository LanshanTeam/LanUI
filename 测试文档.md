ğŸ˜ğŸ˜ æµ‹è¯• ğŸ¤¤ğŸ¤¤ æˆ‘çš„æµ‹è¯• ğŸ¤¤
<a name="exJD8"></a>

# jest æ–­è¨€

<a name="JqVBk"></a>

## åŸºç¡€çŸ¥è¯†

1. test ç”¨äºå®šä¹‰å•ä¸ªçš„ç”¨ä¾‹ï¼Œä¸æ­¤ç±»ä¼¼çš„æœ‰ describe å’Œ itï¼Œdescribe è¡¨ç¤ºä¸€ç»„åˆ†ç»„ï¼Œå…¶ä¸­å¯ä»¥åŒ…å«å¤šä¸ª testï¼Œè€Œ it æ˜¯ test çš„åˆ«åï¼Œæœ‰ç›¸åŒçš„ä½œç”¨

```typescript
import { render, screen } from '@testing-library/react';
import '@testing-library/jest-dom';
import App from './App';

describe('test', () => {
    test('first unit test', () => {
        render(<App />);
        expect(screen.getByText('Vite + React')).toBeInTheDocument();
    });
});
```

-   å¦‚ä¸Šï¼Œåœ¨ describe çš„å›è°ƒä¸­å¯ä»¥åŒ…å«å¤šç»„ testã€‚åœ¨è¿™ä¸ªå•æµ‹ä¸­æˆ‘ä»¬åˆ¤æ–­äº† vite+react æ˜¯å¦åœ¨æˆ‘ä»¬çš„ DOM ä¸­ï¼Œ`screen.getByText`ç”¨äºå…ƒç´ çš„æŸ¥æ‰¾ã€‚
-   å†çœ‹è¿™è¡Œä»£ç `expect(screen.getByText("Vite + React")).toBeInTheDocument();`ï¼Œè¡¨ç¤ºçš„æ˜¯æœŸæœ›(expect)`screen.getByText("vite + react")`è¿™ä¸ªå…ƒç´ `toBeInTheDocument`(å¯ä»¥åœ¨é¡µé¢æ­£æ–‡)
-   ç¨å¾®æ€»ç»“ä¸€ä¸‹ï¼Œexpect å…¶ä¸­çš„å‚æ•°å¡«å…¥ä½ éœ€è¦è¿›è¡Œåˆ¤æ–­çš„å¯¹è±¡ï¼Œ`toBeInTheDocument`è¿™ä¸ª api æ˜¯åŒ¹é…å™¨ã€‚ä¹Ÿç§°æ–­è¨€ï¼Œç”¨æ¥å‘Šè¯‰ç¨‹åºä½ çš„é¢„æœŸæ˜¯ä»€ä¹ˆï¼Œé€šè¿‡å¯¹é¢„æœŸçš„å¯¹è±¡è¿›è¡Œæ–­è¨€å°±æ˜¯å•å…ƒæµ‹è¯•çš„åŸºæœ¬åŸç†

2. å¸¸è§æ–­è¨€åœºæ™¯
   | **åœºæ™¯æ–¹å‘** | æ¶‰åŠçš„æ–­è¨€ Api |
   | --- | --- |
   | åŸºç¡€ç±»å‹çš„æ¯”è¾ƒ | ` not``toBe(value) `<br />`toBeTruthy(value)`<br />`toBeDefined()`<br />`toBeUndefined()`<br />`toBeCloseTo(value)`<br />`toBeNaN()` |
   | å¼•ç”¨ç±»å‹çš„æ¯”è¾ƒ | `toEqual(value)` |
   | æ•°å­—ç¬¦å· | `**toBeGreaterThan(value)** `<br />`toBeLessThan(value) `<br />`toBeGreaterThanOrEqual(value)`<br /> `toBeLessThanOrEqual(value)` |
   | æ­£åˆ™åŒ¹é… | `toMatch(value) `<br />`toMatchObject(value)` |
   | è¡¨å•éªŒè¯ | `toContain(value) `<br />`arrayContaining(value) `<br />`toContainEqual(value) `<br />`toHaveLength(value) `<br />`toHaveProperty(value)` |
   | é”™è¯¯æŠ›å‡º | `toThrow() `<br />`toThrowError()` |

<a name="EWRr2"></a>

## åŸºç¡€ç±»å‹çš„æ¯”è¾ƒ

1. å¸¸è§„ç”¨æ³•

-   `toBe`ï¼šåœ¨åŸºç¡€ç±»å‹ä¸­ï¼Œå¤§éƒ¨åˆ†æ¯”è¾ƒéƒ½å¯ä»¥é€šè¿‡ toBe æ¥å®Œæˆï¼ŒåŒ…æ‹¬ booolean å’Œ undefined

```typescript
test('åŸºç¡€ç±»å‹çš„æ¯”è¾ƒ', () => {
    // tobe
    expect(1 + 1).toBe(2);
    // notï¼Œnotç”¨æ¥è¡¨ç¤ºéçš„åˆ¤æ–­
    expect(1 + 1).not.toBe(3);
});
```

ä¹Ÿå¯ä»¥å¯¹å‡½æ•°è¿”å›çš„ç±»å‹è¿›è¡Œåˆ¤æ–­

```typescript
import React from 'react';
test('åŸºç¡€ç±»å‹çš„æ¯”è¾ƒ', () => {
    const test = () => {
        console.log('wujiayu');
    };
    expect(test()).toBe(undefined);
});
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒtoBe æ— æ³•å¯¹æµ®ç‚¹ç±»å‹è¿›è¡Œæ–­è¨€ï¼Œåº”è¯¥ä½¿ç”¨`toBeCloseTo()`,è¿™ä¸ªæ–­è¨€ç”¨æ¥åˆ¤æ–­å¯¹è±¡å’Œé¢„æœŸçš„ç²¾åº¦æ˜¯å¦è¶³å¤Ÿæ¥è¿‘ï¼Œè€Œä¸å†æ˜¯å…¨ç­‰
<a name="uvI8G"></a>

## å¼•ç”¨ç±»å‹çš„æ–­è¨€

`toEqual`ï¼š`toEqual`ä¼šæ·±åº¦é€’å½’å¯¹è±¡çš„æ¯ä¸ªå±æ€§ï¼Œè¿›è¡Œæ·±åº¦æ¯”è¾ƒï¼Œåªè¦åŸå§‹å€¼ç›¸åŒï¼Œå°±å¯ä»¥é€šè¿‡æ–­è¨€

```typescript
test('å¼•ç”¨ç±»å‹çš„æ¯”è¾ƒ', () => {
    const a = {
        obj1: {
            name: 'obj1',
            obj2: {
                name: 'obj2',
            },
        },
    };
    const b = Object.assign(a); // æµ…
    const c = JSON.parse(JSON.stringify(a)); // æ·±

    expect(a).toBe(b); // âˆš
    expect(a).not.toBe(c); // âˆš
    expect(a).toEqual(b); // âˆš
    expect(a).toEqual(c); // âˆš
});
```

æ³¨ï¼štoEqual ä¹Ÿå¯ä»¥ç”¨äºåŸºç¡€ç±»å‹çš„æ¯”è¾ƒ
<a name="I8HVw"></a>

## æ•°å­—ç¬¦å·çš„æ–­è¨€

```typescript
test('æ•°å­—ç¬¦å·çš„æ–­è¨€', () => {
    // <
    expect(2).toBeLessThan(3); // å…¶å®ƒç¬¦å·åŒç†
});
```

<a name="PTmaF"></a>

## æ­£åˆ™åŒ¹é…

```typescript
test('æ­£åˆ™åŒ¹é…', () => {
    expect('this is a regexp').toMatch(/regexp/);
    const obj = { prop1: 'test', prop2: 'regexp validation' };
    const childObj = { prop1: 'test' };
    expect(obj).toMatchObject(childObj);
});
```

-   `toMatch(regexp)`ä¼šåŒ¹é…å­—ç¬¦ä¸²æ˜¯å¦èƒ½å¤Ÿæ»¡è¶³æ­£åˆ™çš„éªŒè¯
-   `toMatchObject(value)`ç”¨æ¥éªŒè¯å¯¹è±¡èƒ½å¦åŒ…å« value çš„å…¨éƒ¨å±æ€§ï¼Œå³ value æ˜¯å¦æ˜¯åŒ¹é…å¯¹è±¡çš„å­é›†
    <a name="RdBWg"></a>

## è¡¨å•éªŒè¯

-   `toContain(value)`ï¼šåˆ¤å®šæŸä¸ªå€¼æ˜¯å¦å­˜åœ¨åœ¨æ•°ç»„ä¸­
-   `arrayContaining(value)`ï¼šåŒ¹é…æ¥æ”¶åˆ°çš„æ•°ç»„ï¼Œä¸ toEqual ç»“åˆä½¿ç”¨å¯ä»¥ç”¨äºåˆ¤å®šæŸä¸ªæ•°ç»„æ˜¯å¦æ˜¯å¦ä¸€ä¸ªæ•°ç»„çš„å­é›†
-   `toContainEqual(value)`ï¼šç”¨äºåˆ¤å®šæŸä¸ªå¯¹è±¡å…ƒç´ æ˜¯å¦åœ¨æ•°ç»„ä¸­
-   `toHaveLength(value)`ï¼š æ–­è¨€æ•°ç»„çš„é•¿åº¦
-   `toHaveProperty(value)`ï¼šæ–­è¨€å¯¹è±¡ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå±æ€§ï¼Œé’ˆå¯¹å¤šå±‚çº§çš„å¯¹è±¡å¯ä»¥é€šè¿‡ xx.yy çš„æ–¹å¼è¿›è¡Œä¼ å‚æ–­è¨€

```typescript
test('è¡¨å•éªŒè¯', () => {
    // æ•°ç»„å…ƒç´ éªŒè¯
    expect([1, 2, 3]).toContain(1); // åˆ¤æ–­æŸä¸ªå€¼æ˜¯å¦å­˜åœ¨æ•°ç»„ä¸­
    expect([1, 2, 3]).toEqual(expect.arrayContaining([1, 2])); // ä¸toEqualç»“åˆä½¿ç”¨å¯ä»¥åˆ¤å®šæŸä¸ªæ•°ç»„æ˜¯å¦æ˜¯å¦ä¸€ä¸ªæ•°ç»„çš„å­é›†
    expect([{ a: 1, b: 2 }]).toContainEqual({ a: 1, b: 2 }); // ç”¨äºåˆ¤å®šæŸä¸ªå¯¹è±¡å…ƒç´ æ˜¯å¦åœ¨æ•°ç»„ä¸­
    // æ•°ç»„é•¿åº¦
    expect([1, 2, 3]).toHaveLength(3); // æ–­è¨€æ•°ç»„çš„é•¿åº¦
    // å¯¹è±¡å±æ€§éªŒè¯
    const testObj = {
        prop1: 1,
        prop2: {
            child1: 2,
            child2: 'test',
        },
    };
    expect(testObj).toHaveProperty('prop1'); // æ–­è¨€æŸä¸ªå¯¹è±¡æ˜¯å¦å«æœ‰æŸä¸ªå±æ€§
    expect(testObj).toHaveProperty('prop2.child1'); // é’ˆå¯¹å¤šå±‚çº§çš„å¯¹è±¡å¯ä»¥ä½¿ç”¨xx.yyçš„æ–¹å¼è¿›è¡Œä¼ å‚æ–­è¨€
});
```

<a name="QOS5t"></a>

## é”™è¯¯æŠ›å‡º

```typescript
// å­˜åœ¨toThrowError()å’ŒtoThrow()ä¸¤ä¸ªåŒ¹é…å™¨ï¼Œç”¨æ³•ä¸€æ ·ï¼Œå¯ä»¥ç†è§£ä¸ºå¦ä¸€ä¸ªåˆ«å
test('é”™è¯¯æ•è·', () => {
    const throwError = () => {
        const err = new Error('error: cqupt is door');
        throw err;
    };
    expect(throwError).toThrowError();
    expect(throwError).toThrow();

    const catchError = () => {
        try {
            const err = new Error('console err: this is a test error!');
            throw err;
        } catch (err) {
            console.log(err);
        }
    };
    expect(catchError).not.toThrow();
    expect(catchError).not.toThrowError();
});
```

<a name="eGfFd"></a>

## å®ç°è‡ªå®šä¹‰çš„æ–­è¨€

ä½¿ç”¨ extendï¼Œä¸€ä¸ªç®€å•çš„ demoï¼š

```typescript
test('åŒæ­¥è‡ªå®šä¹‰åŒ¹é…å™¨', () => {
    const toBeBetweenZeroAndTen = (num: number) => {
        if (num >= 0 && num <= 10) {
            return {
                message: () => '',
                pass: true,
            };
        } else {
            return {
                message: () =>
                    'expected num to be a number between zero and ten',
                pass: false,
            };
        }
    };
    expect.extend({
        toBeBetweenZeroAndTen,
    });
    expect(8).toBeBetweenZeroAndTen();
    expect(11).not.toBeBetweenZeroAndTen();
});
```

<a name="KIwWn"></a>

# DOM æŸ¥è¯¢ï¼šé¡µé¢å…ƒç´ çš„æ¸²æŸ“å’Œè¡Œä¸ºæŸ¥è¯¢

<a name="b0ufs"></a>

## é¡µé¢å…ƒç´ çš„æ¸²æŸ“

<a name="G9rOl"></a>

### render

-   render ç”¨äºå…ƒç´ çš„æ¸²æŸ“ï¼Œå¹¶ä¸”åœ¨ render æ‰§è¡Œä¹‹åä¼šæŠŠå€¼æ³¨å…¥åˆ° screen å¯¹è±¡ä¸­ï¼Œå¦‚åŒä¸Šé¢ç¬¬ä¸€ä¸ªä¾‹å­

```typescript
import { render, screen } from '@testing-library/react';
import '@testing-library/jest-dom';
import App from './App';

describe('test', () => {
    test('first unit test', () => {
        render(<App />);
        expect(screen.getByText('Vite + React')).toBeInTheDocument();
    });
});
```

-   render å‡½æ•°éœ€è¦æ”¾åœ¨æ¯ä¸ªç‹¬ç«‹çš„ test ä¸­ï¼Œå› ä¸ºåœ¨æ¯ä¸ª test æ‰§è¡Œå®Œä»¥åï¼Œlibrary ä¼šè°ƒç”¨ cleanup æ–¹æ³•æ¥æ¸…ç†ç¯å¢ƒ
    <a name="SHYpW"></a>

## é¡µé¢å…ƒç´ çš„æŸ¥è¯¢

1. åˆ†ç±»ï¼šgetBy getAllBy; queryBy queryAllBy; findBy findAllBy;
2. ä¸åŒç‚¹ï¼š

-   Getï¼šè¿”å›æŸ¥è¯¢çš„åŒ¹é…èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ åŒ¹é…åˆ™ä¼šæŠ¥é”™(é’ˆå¯¹å•æŸ¥å¦‚æœæŸ¥åˆ°å¤šä¸ªä¹Ÿä¼šæŠ¥é”™)
-   Queryï¼šè¿”å›æŸ¥è¯¢çš„åŒ¹é…èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ åŒ¹é…ä¼šè¿”å› nullï¼Œä½†æ˜¯ä¸ä¼šæŠ¥é”™(åŒæ ·é’ˆå¯¹å•æŸ¥ï¼Œå¦‚æœæŸ¥åˆ°å¤šä¸ªåŒ¹é…å…ƒç´ ä¹Ÿä¼šæŠ¥é”™)
-   Findï¼šè¿”å›ä¸€ä¸ª Promiseï¼Œé»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 1000msï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ åŒ¹é…æˆ–è€…æŸ¥æ‰¾è¶…æ—¶ï¼ŒPromise çŠ¶æ€åˆ‡ä¸º reject(åŒæ ·é’ˆå¯¹å•æŸ¥ï¼Œå¦‚æœæŸ¥åˆ°å¤šä¸ªå…ƒç´ ï¼Œä¹Ÿä¼šè¿”å› reject)

3. å½“æŸä¸ªå…ƒç´ çš„å­˜åœ¨å¹¶ä¸å†³å®šè¿™ä¸ªç”¨ä¾‹èƒ½ä¸èƒ½é€šè¿‡ï¼Œé‚£å°±ä½¿ç”¨ queryï¼›å¦‚æœæŸä¸ªå…ƒç´ ä¸å­˜åœ¨ï¼Œåç»­çš„æ­¥éª¤å°±æ²¡æœ‰æ‰§è¡Œçš„æ„ä¹‰ï¼Œé‚£å°±ä½¿ç”¨ get æ¥ç›´æ¥ä¸­æ–­è¿™ä¸ªç”¨ä¾‹
4. ä¾‹å­

```typescript
import { FC } from 'react';

interface IProps {}

export const DomQuery: FC<IProps> = ({}) => {
    return (
        <div>
            <div>test1</div>
            <div>test2</div>
        </div>
    );
};
```

```typescript
import React from 'react';
import { render, screen } from '@testing-library/react';
import { DomQuery } from '../components/DomQuery';

describe('tests for', () => {
    test('get & query & find', () => {
        render(<DomQuery />);
        const element = screen.getByText(/test/i); // æŠ¥é”™ï¼šæ‰¾åˆ°å¤šä¸ªå…ƒç´ 
        screen.debug(element);
    });
});
```

screen.debug æ˜¯æš´éœ²å‡ºæ¥çš„ä¸€ä¸ªè°ƒè¯• apiï¼Œå¯ä»¥å°†æŸ¥è¯¢å‡ºæ¥çš„å…ƒç´ åœ¨æ§åˆ¶å°ä¸Šæ˜¾ç¤º
<a name="EPGsy"></a>

# DOM æŸ¥è¯¢ï¼šé¡µé¢å…ƒç´ çš„å‚ç…§ç‰©æŸ¥è¯¢å’Œä¼˜å…ˆçº§

<a name="GjrQJ"></a>

## æŒ‰ç…§å‚ç…§ç‰©åˆ†ç±»

<a name="Uaxn2"></a>

### role ARIA

-   æ¯”å¦‚ divã€button ç­‰æ ‡ç­¾ï¼Œå³ä½¿æ²¡æœ‰åŠ ä»»ä½•å±æ€§ï¼Œä¹Ÿæœ‰ä¸€ä¸ªéšå½¢çš„ ARIA role å±æ€§æ¥è¡¨ç¤ºå®ƒçš„è¯­ä¹‰ã€‚
    | æ ‡ç­¾ | éšå½¢ ARIA role |
    | --- | --- |
    | a ,href | link |
    | a(æ—  href) body div span | generic |
    | form | form |
    | h1-h6 | heading |
    | html | document |
    | img | img |
    | p | paragraph |
    | table | table |
    | ul | list |
    | li | listitem |

aria ä¸ role é…åˆä½¿ç”¨

```typescript
function App() {
    return (
        <div>
            <button aria-pressed>wujiayu</button>
        </div>
    );
}

export default App;
```

```typescript
import Button from '../App';
import { render, screen } from '@testing-library/react';

test('test role', () => {
    render(<Button />);
    const button = screen.getByRole('button', { pressed: true });
    screen.debug(button);
});
```

-   aria å±æ€§ç”¨æ¥è¡¨ç¤ºå¯¹åº”è§’è‰²ä¸‹çš„é¢å¤–ç‰¹æ®Šå«ä¹‰ï¼Œå¯ä»¥åœ¨å¤šä¸ªç›¸åŒè§’è‰²æ‰¾é‚£ä¸ªé€‰ä¸­æˆ‘ä»¬éœ€è¦çš„ä¸€ä¸ª

`aria-hidden`:ä¸åœ¨ DOM æ ‘ä¸Šè®¿é—®çš„å…ƒç´ <br />`aria-selected`:å…ƒç´ æ˜¯å¦è¢«é€‰ä¸­<br />`aria-checked`ï¼šå…ƒç´ æ˜¯å¦è¢«å‹¾é€‰<br />`aria-current`ï¼šå½“å‰é€‰ä¸­çš„å…ƒç´ <br />`aria-pressed`ï¼šè¢«æŒ‰å‹çš„å…ƒç´ <br />`aria-expanded`ï¼šå…ƒç´ æ˜¯å¦è¢«å±•å¼€<br />`aria-level`ï¼šåŒºåŸŸçš„ç­‰çº§ï¼Œh1-h6 ä¼šæœ‰é»˜è®¤çš„ aria-level å±æ€§ï¼Œå€¼å¯¹åº” 1-6<br />`aria-describedby`ï¼šå¯ä»¥é€šè¿‡æè¿°æ¥å®šä½é¢å¤–çš„å…ƒç´ 

-   ä¾‹å­

```typescript
function App() {
    return (
        <div>
            <button aria-describedby="description">
                <div id="description">è‡ªå®šä¹‰ariaæŒ‰é’®</div>
            </button>
        </div>
    );
}

export default App;
```

```typescript
import Button from '../App';
import { render, screen } from '@testing-library/react';

test('test role', () => {
    render(<Button />);
    const button = screen.getByRole('button', {
        description: 'è‡ªå®šä¹‰ariaæŒ‰é’®',
    });
    screen.debug(button);
});
```

-   ç­›é€‰é¡¹ï¼šnameï¼›é€šè¿‡è¿™ä¸ªå’Œ aria-label æ­é…ä½¿ç”¨ç­›é€‰å‡ºæˆ‘ä»¬éœ€è¦çš„å†…å®¹

```typescript
import { FC } from 'react';

interface IProps {}

export const DomQuery: FC<IProps> = ({}) => {
    return (
        <div>
            <div aria-label="test_note">1234</div>
        </div>
    );
};
```

```typescript
import React from 'react';
import { render, screen } from '@testing-library/react';
import { DomQuery } from '../components/DomQuery';

describe('tests for', () => {
    // ...
    test('aria-label', () => {
        render(<DomQuery />);
        const note = screen.getByRole('generic', { name: 'test_note' });
        screen.debug(note);
    });
});
```

<a name="gTCt3"></a>

## å…¶å®ƒå‚ç…§ç‰©

-   æ ‡ç­¾æ–‡æœ¬ï¼šé’ˆå¯¹ label æ ‡ç­¾çš„ text æŸ¥è¯¢

`const label = screen.getByLabelText("testLabel") `

-   å ä½ç¬¦æ–‡æœ¬(placeholdertext):é€šè¿‡ placeholder æ¥æŸ¥è¯¢

`**const** placeholderInput = screen.**getByPlaceholderText**( "a query by placeholder" );`

-   è¡¨å• value(displayValue):æ ¹æ®è¡¨å•å…ƒç´ çš„å€¼æ¥æŸ¥è¯¢

`const valueInput = screen.getByDisPlayValue("a query by value")`
<a name="OnZf6"></a>

## æŸ¥è¯¢çš„ä¼˜å…ˆçº§

-   ä¸»åŠ¨ä½¿ç”¨ï¼šgetByRoleã€getByLabelText ç­‰
-   è€ƒè™‘ä½¿ç”¨ï¼šgetByAltTextã€getByTitle ç­‰
-   å°½é‡ä¸ç”¨ï¼šgetByTestId ç­‰
